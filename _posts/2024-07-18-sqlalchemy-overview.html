---
layout: page
title: SQLAlchemy
tagline: " brief overivew"
permalink: /python/sqlalchemy-dissection.html
categories: [SQLAlchemy, Python]
tags: [overview]
---
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3dfeecc">Zero-Shot</a>
<ul>
<li><a href="#org01f8574">1. Basics and Setup</a></li>
<li><a href="#org8025459">2. Core Concepts</a></li>
<li><a href="#orgbc822bf">3. SQLAlchemy ORM</a></li>
<li><a href="#org29ea104">4. CRUD Operations</a></li>
<li><a href="#orgb3637c0">5. Querying</a></li>
<li><a href="#org63a6539">6. Relationships</a></li>
<li><a href="#org5e9971c">7. Advanced Topics</a></li>
<li><a href="#org40fa05e">8. Performance and Scalability</a></li>
<li><a href="#orgb7baf89">9. Customization and Extensions</a></li>
<li><a href="#orgcd0d01f">10. Practical Usage and Best Practices</a></li>
<li><a href="#org61c32f2">Resources:</a></li>
</ul>
</li>
<li><a href="#org6616d92">Prerequisites</a></li>
<li><a href="#org4fb31e7">What is SQLAlchemy, and what are the main components of this library?</a>
<ul>
<li><a href="#org11cad68">Main Components of SQLAlchemy:</a></li>
<li><a href="#org607d23f">Below is an example</a></li>
<li><a href="#org8b66fa6">Explanations:</a></li>
</ul>
</li>
<li><a href="#orgdf569a8">What is the purpose of usage of object-relational mapping?</a>
<ul>
<li><a href="#orgf136bdc">Purpose of ORM Usage:</a></li>
<li><a href="#orgf3bae64">Example Use Cases in SQLAlchemy:</a>
<ul>
<li><a href="#orgd0a9805">1. Abstraction and Simplicity:</a></li>
<li><a href="#org7160370">2. Maintainability:</a></li>
<li><a href="#orgdb90618">3. Portability:</a></li>
<li><a href="#orgc98f38b">4. Security:</a></li>
</ul>
</li>
<li><a href="#org40143e3">Additional Considerations:</a></li>
<li><a href="#org6fd312a">The Essence</a></li>
</ul>
</li>
<li><a href="#org548d87f">Clarification</a></li>
</ul>
</div>
</div>
<div id="outline-container-org3dfeecc" class="outline-2">
<h2 id="org3dfeecc">Zero-Shot</h2>
<div class="outline-text-2" id="text-org3dfeecc">
<blockquote>
<p>
I want to stydy SQLAlchemy library from zero to hero. Which questions
you could suggest to ask to unvail this topic in a much effective way?
</p>
</blockquote>


<p>
Studying the SQLAlchemy library thoroughly from foundational concepts
to advanced usage can be effectively achieved by structuring your
inquiries in a progressive manner. Here are some questions, starting
from basic to advanced, to help uncover and deeply understand the
SQLAlchemy library:
</p>
</div>

<div id="outline-container-org01f8574" class="outline-3">
<h3 id="org01f8574">1. Basics and Setup</h3>
<div class="outline-text-3" id="text-org01f8574">
<ul class="org-ul">
<li>What is SQLAlchemy, and what are the main components of this
library?</li>
<li>How can I install SQLAlchemy in my Python environment?</li>
<li>What are the differences between SQLAlchemy Core and SQLAlchemy
ORM?</li>
</ul>
</div>
</div>

<div id="outline-container-org8025459" class="outline-3">
<h3 id="org8025459">2. Core Concepts</h3>
<div class="outline-text-3" id="text-org8025459">
<ul class="org-ul">
<li>How do I connect to a database using SQLAlchemy?</li>
<li>What are <code>Engine</code> and <code>Session</code> in SQLAlchemy, and how do they
interact?</li>
<li>How do I define and create tables using SQLAlchemy Core?</li>
</ul>
</div>
</div>

<div id="outline-container-orgbc822bf" class="outline-3">
<h3 id="orgbc822bf">3. SQLAlchemy ORM</h3>
<div class="outline-text-3" id="text-orgbc822bf">
<ul class="org-ul">
<li>What is an ORM (Object-Relational Mapping) and why use SQLAlchemy
ORM?</li>
<li>How do I define a model (class) using SQLAlchemy ORM?</li>
<li>What are the common column types provided by SQLAlchemy?</li>
</ul>
</div>
</div>

<div id="outline-container-org29ea104" class="outline-3">
<h3 id="org29ea104">4. CRUD Operations</h3>
<div class="outline-text-3" id="text-org29ea104">
<ul class="org-ul">
<li>How can I perform Create operations (insert rows) using
SQLAlchemy ORM?</li>
<li>How can I perform Read operations (query rows) using SQLAlchemy
ORM?</li>
<li>How can I perform Update operations using SQLAlchemy ORM?</li>
<li>How can I perform Delete operations using SQLAlchemy ORM?</li>
</ul>
</div>
</div>

<div id="outline-container-orgb3637c0" class="outline-3">
<h3 id="orgb3637c0">5. Querying</h3>
<div class="outline-text-3" id="text-orgb3637c0">
<ul class="org-ul">
<li>How do I use SQLAlchemy to filter, sort, and limit query results?</li>
<li>What is the <code>Query</code> object, and how does it work?</li>
<li>How can I use joins to combine data from multiple tables?</li>
</ul>
</div>
</div>

<div id="outline-container-org63a6539" class="outline-3">
<h3 id="org63a6539">6. Relationships</h3>
<div class="outline-text-3" id="text-org63a6539">
<ul class="org-ul">
<li>What are relationships in SQLAlchemy, and how can I define them?</li>
<li>What is the difference between one-to-many, many-to-one, and
many-to-many relationships?</li>
<li>How can I handle lazy loading and eager loading in relationships?</li>
</ul>
</div>
</div>

<div id="outline-container-org5e9971c" class="outline-3">
<h3 id="org5e9971c">7. Advanced Topics</h3>
<div class="outline-text-3" id="text-org5e9971c">
<ul class="org-ul">
<li>How do I handle transactions and sessions in SQLAlchemy?</li>
<li>What are hybrid attributes, and how can they be utilized in
SQLAlchemy?</li>
<li>How can I use SQLAlchemy with Alembic for database migrations?</li>
</ul>
</div>
</div>

<div id="outline-container-org40fa05e" class="outline-3">
<h3 id="org40fa05e">8. Performance and Scalability</h3>
<div class="outline-text-3" id="text-org40fa05e">
<ul class="org-ul">
<li>What strategies can be employed to optimize the performance of
queries in SQLAlchemy?</li>
<li>How do I use connection pooling in SQLAlchemy?</li>
<li>How can I profile and benchmark SQLAlchemy-based applications?</li>
</ul>
</div>
</div>

<div id="outline-container-orgb7baf89" class="outline-3">
<h3 id="orgb7baf89">9. Customization and Extensions</h3>
<div class="outline-text-3" id="text-orgb7baf89">
<ul class="org-ul">
<li>How can I create custom types and composite types in SQLAlchemy?</li>
<li>What are SQLAlchemy events, and how can I use them to customize
behavior?</li>
<li>How can I extend SQLAlchemy with plugins and third-party
libraries?</li>
</ul>
</div>
</div>

<div id="outline-container-orgcd0d01f" class="outline-3">
<h3 id="orgcd0d01f">10. Practical Usage and Best Practices</h3>
<div class="outline-text-3" id="text-orgcd0d01f">
<ul class="org-ul">
<li>What are some common pitfalls and how can they be avoided?</li>
<li>How can I structure a large SQLAlchemy application?</li>
<li>How do I use SQLAlchemy in a web application (e.g., with Flask or
Django)?</li>
</ul>

<p>
By studying and finding answers to these questions, you'll gain a
solid understanding of the SQLAlchemy library, its features, and its
best practices. Below are some resources that can help:
</p>
</div>
</div>
<div id="outline-container-org61c32f2" class="outline-3">
<h3 id="org61c32f2">Resources:</h3>
<div class="outline-text-3" id="text-org61c32f2">
<ul class="org-ul">
<li>Official SQLAlchemy Documentation: [SQLAlchemy
Docs](<a href="https://docs.sqlalchemy.org/">https://docs.sqlalchemy.org/</a>)</li>
<li>SQLAlchemy Core Tutorial: [Getting Started with SQLAlchemy
Core](<a href="https://docs.sqlalchemy.org/en/14/core/tutorial.html">https://docs.sqlalchemy.org/en/14/core/tutorial.html</a>)</li>
<li>SQLAlchemy ORM Tutorial: [Getting Started with SQLAlchemy
ORM](<a href="https://docs.sqlalchemy.org/en/14/orm/tutorial.html">https://docs.sqlalchemy.org/en/14/orm/tutorial.html</a>)</li>
<li>SQLAlchemy Essentials by O'Reilly: [SQLAlchemy Essentials
Book](<a href="https://www.oreilly.com/library/view/sqlalchemy-essentials/9781785283471/">https://www.oreilly.com/library/view/sqlalchemy-essentials/9781785283471/</a>)</li>
</ul>

<p>
Feel free to refine or expand this question list based on specific
areas of interest or projects you might be working on!
#+end_src
</p>
</div>
</div>
</div>
<div id="outline-container-org6616d92" class="outline-2">
<h2 id="org6616d92">Prerequisites</h2>
<div class="outline-text-2" id="text-org6616d92">
<div class="org-src-container">
<pre class="src src-sh">pip install sqlalchemy
</pre>
</div>

<pre class="example" id="orgbd19e8b">
Collecting sqlalchemy
  Downloading SQLAlchemy-2.0.31-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.2 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3.2/3.2 MB 3.6 MB/s eta 0:00:00
=4.6.0 in /home/alioth/.virtualenvs/FastAPI/lib/python3.11/site-packages (from sqlalchemy) (4.12.2)
Collecting greenlet!=0.4.17
  Downloading greenlet-3.0.3-cp311-cp311-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl (620 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 620.0/620.0 kB 4.0 MB/s eta 0:00:00

Installing collected packages: greenlet, sqlalchemy
Successfully installed greenlet-3.0.3 sqlalchemy-2.0.31
</pre>
</div>
</div>

<div id="outline-container-org4fb31e7" class="outline-2">
<h2 id="org4fb31e7">What is SQLAlchemy, and what are the main components of this library?</h2>
<div class="outline-text-2" id="text-org4fb31e7">
<p>
SQLAlchemy is a powerful and popular SQL toolkit and Object-Relational
Mapping (ORM) library for Python. It provides a set of high-level APIs
to interact with relational databases in a more Pythonic and
object-oriented way. SQLAlchemy aims to simplify database operations
while maintaining flexibility and control over SQL queries.
</p>
</div>

<div id="outline-container-org11cad68" class="outline-3">
<h3 id="org11cad68">Main Components of SQLAlchemy:</h3>
<div class="outline-text-3" id="text-org11cad68">
<ol class="org-ol">
<li><b>SQLAlchemy Core (SQL Expression Language):</b>
<ul class="org-ul">
<li><b>Engine:</b> The core interface that communicates with the
database. It manages connections and handles SQL statement
executions.</li>
<li><b>MetaData:</b> A central registry where information about tables,
columns, and constraints is stored.</li>
<li><b>Table:</b> Represents a table in the database and can be used to
define schema and perform SQL operations.</li>
<li><b>Column:</b> Represents a column in a table, defining its type and
constraints.</li>
<li><b>SQL Expression Language:</b> Provides a set of constructs to
programmatically build SQL queries using Python.</li>
</ul></li>

<li><b>SQLAlchemy ORM (Object-Relational Mapping):</b>
<ul class="org-ul">
<li><b>Declarative Base:</b> A base class that allows you to define
table structures and mappings using Python classes.</li>
<li><b>Session:</b> Manages the conversation with the database, handling
operations like querying and persisting objects.</li>
<li><b>Query:</b> A method to construct database queries using
ORM-mapped classes.</li>
<li><b>Mapper:</b> Maps Python classes to database tables, allowing for
object-oriented access to database records.</li>
<li><b>Relationships:</b> Tools to define relationships between
different tables, such as one-to-many or many-to-many.</li>
</ul></li>

<li><b>Schema Migration (Alembic):</b>
<ul class="org-ul">
<li><b>Alembic:</b> A companion library used for handling database
migrations. It helps in upgrading and downgrading the database
schema over time.</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-org607d23f" class="outline-3">
<h3 id="org607d23f">Below is an example</h3>
<div class="outline-text-3" id="text-org607d23f">
<p>
Demonstrating the basic usage of both SQLAlchemy Core and SQLAlchemy
ORM:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> sqlalchemy <span class="org-keyword">import</span> create_engine, Table, Column, Integer, String, MetaData
<span class="org-keyword">from</span> sqlalchemy.ext.declarative <span class="org-keyword">import</span> declarative_base
<span class="org-keyword">from</span> sqlalchemy.orm <span class="org-keyword">import</span> sessionmaker

<span class="org-comment-delimiter"># </span><span class="org-comment">SQLAlchemy Core Example</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Create an engine and connect to the database (SQLite in this case)</span>
<span class="org-variable-name">engine</span> = create_engine(<span class="org-string">'sqlite:///:memory:'</span>, echo=<span class="org-constant">True</span>)
metadata = MetaData()

<span class="org-comment-delimiter"># </span><span class="org-comment">Define a table using SQLAlchemy Core</span>
user_table = Table(<span class="org-string">'users'</span>, metadata, Column(<span class="org-string">'id'</span>, Integer,
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>  primary_key=<span class="org-constant">True</span>), Column(<span class="org-string">'name'</span>, String),
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>  Column(<span class="org-string">'age'</span>, Integer))

<span class="org-comment-delimiter"># </span><span class="org-comment">Create the table in the database</span>
metadata.create_all(engine)

<span class="org-comment-delimiter"># </span><span class="org-comment">SQLAlchemy ORM Example</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Define a declarative base class</span>
Base = declarative_base()

<span class="org-comment-delimiter"># </span><span class="org-comment">Define a User class mapped to the 'users' table</span>


<span class="org-keyword">class</span> <span class="org-type">User</span>(Base):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   __tablename__ = <span class="org-string">'users'</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-builtin">id</span> = Column(Integer, primary_key=<span class="org-constant">True</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   name = Column(String)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   age = Column(Integer)


<span class="org-comment-delimiter"># </span><span class="org-comment">Create a session</span>
Session = sessionmaker(bind=engine)
session = Session()

<span class="org-comment-delimiter"># </span><span class="org-comment">Add a new user to the database</span>
new_user = User(name=<span class="org-string">"Alice"</span>, age=30)
session.add(new_user)
session.commit()

<span class="org-comment-delimiter"># </span><span class="org-comment">Query the database</span>
<span class="org-keyword">for</span> user <span class="org-keyword">in</span> session.query(User).<span class="org-builtin">all</span>():
<span class="org-highlight-indentation"> </span>   <span class="org-builtin">print</span>(user.<span class="org-builtin">id</span>, user.name, user.age)
</pre>
</div>

<pre class="example" id="org0faace2">
2024-07-20 10:33:03,681 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-07-20 10:33:03,682 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("users")
2024-07-20 10:33:03,682 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-07-20 10:33:03,682 INFO sqlalchemy.engine.Engine PRAGMA temp.table_info("users")
2024-07-20 10:33:03,683 INFO sqlalchemy.engine.Engine [raw sql] ()
2024-07-20 10:33:03,683 INFO sqlalchemy.engine.Engine 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	name VARCHAR, 
	age INTEGER, 
	PRIMARY KEY (id)
)


2024-07-20 10:33:03,684 INFO sqlalchemy.engine.Engine [no key 0.00011s] ()
2024-07-20 10:33:03,684 INFO sqlalchemy.engine.Engine COMMIT
/tmp/babel-C8lSuP/python-uwm0l3:20: MovedIn20Warning: The ~~declarative_base()~~ function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
  Base = declarative_base()
2024-07-20 10:33:03,688 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-07-20 10:33:03,690 INFO sqlalchemy.engine.Engine INSERT INTO users (name, age) VALUES (?, ?)
2024-07-20 10:33:03,690 INFO sqlalchemy.engine.Engine [generated in 0.00016s] ('Alice', 30)
2024-07-20 10:33:03,690 INFO sqlalchemy.engine.Engine COMMIT
2024-07-20 10:33:03,691 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-07-20 10:33:03,692 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.name AS users_name, users.age AS users_age 
FROM users
2024-07-20 10:33:03,692 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ()
1 Alice 30
</pre>

<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">Add another user to the database</span>
<span class="org-variable-name">new_user</span> = User(name=<span class="org-string">"Bob"</span>, age=32)
session.add(new_user)
session.commit()

<span class="org-comment-delimiter"># </span><span class="org-comment">Query the database</span>
<span class="org-keyword">for</span> user <span class="org-keyword">in</span> session.query(User).<span class="org-builtin">all</span>():
<span class="org-highlight-indentation"> </span>   <span class="org-builtin">print</span>(user.<span class="org-builtin">id</span>, user.name, user.age)
</pre>
</div>

<pre class="example">
2024-07-20 10:35:27,323 INFO sqlalchemy.engine.Engine INSERT INTO users (name, age) VALUES (?, ?)
2024-07-20 10:35:27,323 INFO sqlalchemy.engine.Engine [cached since 143.6s ago] ('Bob', 32)
2024-07-20 10:35:27,323 INFO sqlalchemy.engine.Engine COMMIT
2024-07-20 10:35:27,323 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2024-07-20 10:35:27,324 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.name AS users_name, users.age AS users_age 
FROM users
2024-07-20 10:35:27,324 INFO sqlalchemy.engine.Engine [cached since 143.6s ago] ()
1 Alice 30
2 Bob 32
</pre>
</div>
</div>

<div id="outline-container-org8b66fa6" class="outline-3">
<h3 id="org8b66fa6">Explanations:</h3>
<div class="outline-text-3" id="text-org8b66fa6">
<ol class="org-ol">
<li><b>Core Example:</b>
<ul class="org-ul">
<li><code>create_engine</code>: Establishes a connection to the database.</li>
<li><code>MetaData</code>: Stores definitions of tables and their schemas.</li>
<li><code>Table</code> and <code>Column</code>: Define a table and its columns.</li>
<li><code>create_all</code>: Creates the table in the database.</li>
</ul></li>

<li><b>ORM Example:</b>
<ul class="org-ul">
<li><code>declarative_base</code>: Creates a base class for declarative class definitions.</li>
<li><code>User</code>: Defines a mapped class representing a table.</li>
<li><code>Session</code>: Manages database operations and transactions.</li>
<li><code>session.add</code> and <code>session.commit</code>: Adds and commits transactions.</li>
<li><code>session.query</code>: Queries the database for records.</li>
</ul></li>
</ol>

<p>
This example showcases the core functionality of SQLAlchemy,
illustrating how it provides powerful abstractions for working with
databases. For further exploration, refer to the official SQLAlchemy
documentation and tutorials.
</p>
</div>
</div>
</div>


<div id="outline-container-orgdf569a8" class="outline-2">
<h2 id="orgdf569a8">What is the purpose of usage of object-relational mapping?</h2>
<div class="outline-text-2" id="text-orgdf569a8">
<p>
Object-Relational Mapping (ORM) is a programming technique used to
convert data between incompatible type systems in object-oriented
programming languages. In simpler terms, ORM allows developers to
interact with a relational database using the idioms and patterns of
their preferred programming language, transforming complex SQL queries
and operations into more intuitive and manageable code constructs.
</p>
</div>

<div id="outline-container-orgf136bdc" class="outline-3">
<h3 id="orgf136bdc">Purpose of ORM Usage:</h3>
<div class="outline-text-3" id="text-orgf136bdc">
<ol class="org-ol">
<li><b>Abstraction and Simplicity:</b>
<ul class="org-ul">
<li><b>Reduces Boilerplate Code:</b> ORM frameworks abstract much of the
repetitive SQL code that developers would otherwise need to
write. This leads to cleaner and more readable code.</li>
<li><b>Ease of Use:</b> By representing tables as classes and rows as
objects, ORMs allow developers to use object-oriented principles
to interact with database records.</li>
</ul></li>

<li><b>Maintainability:</b>
<ul class="org-ul">
<li><b>Centralized Schema Management:</b> With ORM, the database schema
is often defined in the application's code. This centralizes
schema changes and helps keep the database schema in sync with
the application logic.</li>
<li><b>Shorter Development Cycle:</b> ORM simplifies CRUD (Create, Read,
Update, Delete) operations, making it easier to implement and
maintain code, especially in large applications.</li>
</ul></li>

<li><b>Portability:</b>
<ul class="org-ul">
<li><b>Database-agnostic Code:</b> ORMs provide a layer of abstraction
that allows applications to be more database-agnostic. By
changing the ORM configuration, you can switch databases with
minimal changes to the application code.</li>
</ul></li>

<li><b>Productivity:</b>
<ul class="org-ul">
<li><b>Faster Prototyping:</b> ORMs enable faster development cycles by
allowing developers to quickly prototype applications without
needing to write complex SQL queries.</li>
<li><b>Declarative Relationships:</b> Defining relationships
(one-to-one, one-to-many, many-to-many) between tables is more
straightforward and declarative with ORM, leading to fewer errors
and more predictable behavior.</li>
</ul></li>

<li><b>Security:</b>
<ul class="org-ul">
<li><b>SQL Injection Protection:</b> ORMs often include mechanisms to
prevent SQL injection attacks by properly escaping and
parameterizing queries, reducing the risk of introducing
vulnerabilities.</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orgf3bae64" class="outline-3">
<h3 id="orgf3bae64">Example Use Cases in SQLAlchemy:</h3>
<div class="outline-text-3" id="text-orgf3bae64">
</div>
<div id="outline-container-orgd0a9805" class="outline-4">
<h4 id="orgd0a9805">1. Abstraction and Simplicity:</h4>
<div class="outline-text-4" id="text-orgd0a9805">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> sessionmaker
<span class="org-keyword">from</span> sqlalchemy <span class="org-keyword">import</span> Column, Integer, String, create_engine
<span class="org-keyword">from</span> sqlalchemy.ext.declarative
<span class="org-keyword">import</span> declarative_base <span class="org-keyword">from</span> sqlalchemy.orm

<span class="org-comment-delimiter"># </span><span class="org-comment">Define the database connection and base</span>
<span class="org-variable-name">engine</span> = create_engine(<span class="org-string">'sqlite:///example.db'</span>, echo=<span class="org-constant">True</span>)
<span class="org-comment-delimiter">#</span><span class="org-comment">**Explanation of the Connection URL:**</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">- ~sqlite://~: Specifies that the SQLite dialect should be used.</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">- ~/example.db~: Indicates that the database file ~example.db~ is located in the current working directory.</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Create an engine that uses an in-memory SQLite database</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">engine = create_engine('sqlite:///:memory:', echo=True)</span>

Base = declarative_base()

<span class="org-comment-delimiter"># </span><span class="org-comment">Define a User class mapped to a users table</span>


<span class="org-keyword">class</span> <span class="org-type">User</span>(Base):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   __tablename__ = <span class="org-string">'users'</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-builtin">id</span> = Column(Integer, primary_key=<span class="org-constant">True</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   name = Column(String)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   age = Column(Integer)


<span class="org-comment-delimiter"># </span><span class="org-comment">Create a session</span>
Session = sessionmaker(bind=engine)
session = Session()

<span class="org-comment-delimiter"># </span><span class="org-comment">Adding a new user (CRUD operation)</span>
new_user = User(name=<span class="org-string">"Alice"</span>, age=30)
session.add(new_user)
session.commit()

<span class="org-comment-delimiter"># </span><span class="org-comment">Querying the database</span>
users = session.query(User).<span class="org-builtin">all</span>()

<span class="org-keyword">for</span> user <span class="org-keyword">in</span> users:
<span class="org-highlight-indentation"> </span>   <span class="org-builtin">print</span>(user.<span class="org-builtin">id</span>, user.name, user.age)
</pre>
</div>
</div>
</div>


<div id="outline-container-org7160370" class="outline-4">
<h4 id="org7160370">2. Maintainability:</h4>
<div class="outline-text-4" id="text-org7160370">
<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">Alter the User class to add a new column</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">class User(Base):</span>
<span class="org-comment-delimiter">#     </span><span class="org-comment">__tablename__ = 'users'</span>
<span class="org-comment-delimiter">#     </span><span class="org-comment">id = Column(Integer, primary_key=True)</span>
<span class="org-comment-delimiter">#     </span><span class="org-comment">name = Column(String)</span>
<span class="org-comment-delimiter">#     </span><span class="org-comment">age = Column(Integer)</span>
<span class="org-comment-delimiter">#     </span><span class="org-comment">email = Column(String)  # Added column</span>

<span class="org-comment-delimiter"># </span><span class="org-comment"># Reflect the changes in the database schema</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Base.metadata.create_all(engine)</span>

<span class="org-keyword">for</span> user <span class="org-keyword">in</span> session.query(User).<span class="org-builtin">all</span>():
<span class="org-highlight-indentation"> </span>   <span class="org-builtin">print</span>(user.<span class="org-builtin">id</span>, user.name, user.age)
</pre>
</div>

<pre class="example">
2024-07-20 10:46:30,462 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.name AS users_name, users.age AS users_age 
FROM users
2024-07-20 10:46:30,462 INFO sqlalchemy.engine.Engine [cached since 806.8s ago] ()
1 Alice 30
2 Bob 32
</pre>
</div>
</div>


<div id="outline-container-orgdb90618" class="outline-4">
<h4 id="orgdb90618">3. Portability:</h4>
<div class="outline-text-4" id="text-orgdb90618">
<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">Changing the database connection string to use PostgreSQL instead of SQLite</span>
<span class="org-variable-name">engine</span> = create_engine(<span class="org-string">'postgresql://user:password@localhost/dbname'</span>)
<span class="org-variable-name">Session</span> = sessionmaker(bind=engine)
session = Session()

<span class="org-comment-delimiter"># </span><span class="org-comment">Existing ORM code remains unchanged, ensuring portability across databases</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgc98f38b" class="outline-4">
<h4 id="orgc98f38b">4. Security:</h4>
<div class="outline-text-4" id="text-orgc98f38b">
<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">ORM helps prevent SQL injection by using parameterized queries</span>
<span class="org-variable-name">user_id</span> = 1
<span class="org-variable-name">user</span> = session.query(User).<span class="org-builtin">filter</span>(User.<span class="org-builtin">id</span> == user_id).one()
<span class="org-builtin">print</span>(user.name)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org40143e3" class="outline-3">
<h3 id="org40143e3">Additional Considerations:</h3>
<div class="outline-text-3" id="text-org40143e3">
<ul class="org-ul">
<li>ORMs come with some overhead, which can impact performance in
high-throughput applications.</li>
<li>Direct SQL queries might still be necessary for complex queries or
performance-critical parts of an application.</li>
<li>Understanding the underlying SQL and being aware of the trade-offs
is important when using ORMs.</li>
</ul>
</div>
</div>

<div id="outline-container-org6fd312a" class="outline-3">
<h3 id="org6fd312a">The Essence</h3>
<div class="outline-text-3" id="text-org6fd312a">
<p>
Overall, the purpose of ORM is to bridge the gap between relational
databases and object-oriented programming, providing a more intuitive
and efficient way to interact with databases while improving code
maintainability, security, and portability.
</p>
</div>
</div>
</div>

<div id="outline-container-org548d87f" class="outline-2">
<h2 id="org548d87f">Clarification</h2>
<div class="outline-text-2" id="text-org548d87f">
<p>
So, as I can understand the string:
</p>

<p>
engine = create_engine('sqlite:///example.db', echo=True)
</p>

<p>
initiate database in RAM, not at the hard drive?
</p>

<p>
Actually, the provided string:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">engine</span> = create_engine(<span class="org-string">'sqlite:///example.db'</span>, echo=<span class="org-constant">True</span>)
</pre>
</div>


<p>
initializes a connection to an SQLite database stored in a file named
<code>example.db</code> located in the current working directory on the hard
drive. The <code>sqlite:///example.db</code> URL indicates that SQLite should use
a file-based database.
</p>

<p>
<b><b>Explanation of the Connection URL:</b></b>
</p>
<ul class="org-ul">
<li><code>sqlite://</code>: Specifies that the SQLite dialect should be used.</li>
<li><code>/example.db</code>: Indicates that the database file <code>example.db</code> is
located in the current working directory.</li>
</ul>

<p>
If you want to create a SQLite database in RAM (which resides in
memory and is ephemeral), you need to modify the connection string as
follows:
</p>


<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">engine</span> = create_engine(<span class="org-string">'sqlite:///:memory:'</span>, echo=<span class="org-constant">True</span>)
</pre>
</div>


<p>
<b><b>Explanation of the In-Memory Connection URL:</b></b>
</p>
<ul class="org-ul">
<li><code>sqlite://</code>: Specifies that the SQLite dialect should be used.</li>
<li><code>/:memory:</code>: Indicates that the SQLite database should be created in RAM.</li>
</ul>

<p>
<b><b>Example Initializing a Database in RAM:</b></b>
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> sqlalchemy <span class="org-keyword">import</span> create_engine, Table, Column, Integer, String, MetaData
<span class="org-keyword">from</span> sqlalchemy.ext.declarative <span class="org-keyword">import</span> declarative_base
<span class="org-keyword">from</span> sqlalchemy.orm <span class="org-keyword">import</span> sessionmaker

<span class="org-comment-delimiter"># </span><span class="org-comment">Create an engine that uses an in-memory SQLite database</span>
<span class="org-variable-name">engine</span> = create_engine(<span class="org-string">'sqlite:///:memory:'</span>, echo=<span class="org-constant">True</span>)
metadata = MetaData()
Base = declarative_base()

<span class="org-comment-delimiter"># </span><span class="org-comment">Define a Table and ORM model</span>
user_table = Table(<span class="org-string">'users'</span>, metadata,
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>  Column(<span class="org-string">'id'</span>, Integer, primary_key=<span class="org-constant">True</span>),
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>  Column(<span class="org-string">'name'</span>, String),
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>  Column(<span class="org-string">'age'</span>, Integer))

<span class="org-keyword">class</span> <span class="org-type">User</span>(Base):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   __tablename__ = <span class="org-string">'users'</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-builtin">id</span> = Column(Integer, primary_key=<span class="org-constant">True</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   name = Column(String)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   age = Column(Integer)

<span class="org-comment-delimiter"># </span><span class="org-comment">Create the table in the in-memory database</span>
metadata.create_all(engine)

<span class="org-comment-delimiter"># </span><span class="org-comment">Create a session</span>
Session = sessionmaker(bind=engine)
session = Session()

<span class="org-comment-delimiter"># </span><span class="org-comment">Add a new user to the in-memory database</span>
new_user = User(name=<span class="org-string">"Alice"</span>, age=30)
session.add(new_user)
session.commit()

<span class="org-comment-delimiter"># </span><span class="org-comment">Query the in-memory database</span>
<span class="org-keyword">for</span> user <span class="org-keyword">in</span> session.query(User).<span class="org-builtin">all</span>():
<span class="org-highlight-indentation"> </span>   <span class="org-builtin">print</span>(user.<span class="org-builtin">id</span>, user.name, user.age)
</pre>
</div>


<p>
<b><b>Points to Note:</b></b>
</p>
<ol class="org-ol">
<li><b><b>Persistence:</b></b> The <code>example.db</code> file persists on the filesystem, making the database durable until manually deleted.</li>
<li><b><b>In-Memory Database:</b></b> The <code>:memory:</code> database is temporary, meaning it is lost when the program exits. It is useful for testing or situations where you need a fast, transient database.</li>
<li><b><b>Connection URL Details:</b></b>
<ul class="org-ul">
<li><code>sqlite:///example.db</code>: File-based SQLite database on disk.</li>
<li><code>sqlite:///:memory:</code>: In-memory SQLite database.</li>
</ul></li>
</ol>

<p>
In conclusion, to create a database in RAM, you need to use
<code>sqlite:///:memory:</code>, whereas <code>sqlite:///example.db</code> creates a durable
database file on the hard drive.
</p>
</div>
</div>
