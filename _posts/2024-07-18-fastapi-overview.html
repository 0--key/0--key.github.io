---
layout: page
title: FastAPI General Concepts
tagline: " brief overivew"
permalink: /python/fastapi-bief-overview.html
categories: [FastAPI, Python]
tags: [overview]
---
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6ddc63c">Zero-Shot</a>
<ul>
<li><a href="#org0c80afc">General Definitions</a></li>
<li><a href="#orgb9b5cf7">The Appropriate Answer Format Request</a></li>
<li><a href="#org1a377b6">Overview of FastAPI</a></li>
<li><a href="#org52d5833">Example FastAPI Application</a></li>
<li><a href="#org2a374bd">Additional Clarifications</a>
<ul>
<li><a href="#org1e6fbe8">What is RESTful API?</a>
<ul>
<li><a href="#orgfedbad0">Example of a RESTful API using FastAPI</a></li>
</ul>
</li>
<li><a href="#orgd365e29">Babel Subtleties</a>
<ul>
<li><a href="#org3b251c0">Steps to Test FastAPI Application Using unittest</a></li>
<li><a href="#org6326c58">FastAPI Application</a></li>
<li><a href="#orgb4dbca9">Unit Tests for FastAPI Application</a></li>
<li><a href="#org57e23ce">Launch FastAPI Application</a></li>
<li><a href="#org7ba52f3">Run Unit Tests</a></li>
</ul>
</li>
<li><a href="#org0529b15">Explanation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5a06325">What is the purpose of usage of FastAPI?</a>
<ul>
<li><a href="#org8e5febf"><b>High Performance</b>:</a></li>
<li><a href="#org60cef72">Developer Productivity:</a></li>
<li><a href="#org7042733">Ease of Use:</a></li>
<li><a href="#orgf90a4d3">Data Validation and Serialization:</a></li>
<li><a href="#orgd36d1f1">Asynchronous Support:</a></li>
<li><a href="#orgb29c4c3">Dependency Injection:</a></li>
<li><a href="#orgb0dbf0b">Interactive API Documentation:</a></li>
<li><a href="#org355ebaf">Security:</a></li>
<li><a href="#orgc819e43">Example Purposes</a></li>
<li><a href="#org0b21e43">Example of FastAPI Usage</a></li>
<li><a href="#org7e94918">Summary</a></li>
</ul>
</li>
<li><a href="#org6ae96ea">What is Starlette framework and how it used in FastAPI?</a>
<ul>
<li><a href="#org2ce3255">ASGI Support:</a></li>
<li><a href="#org8df5df2">Routing:</a></li>
<li><a href="#orgb38b3cc">Middleware:</a></li>
<li><a href="#org51f102e">Session Management:</a></li>
<li><a href="#org2ec515e">Authentication:</a></li>
<li><a href="#org018774a">WebSockets:</a></li>
<li><a href="#org299c2ca">GraphQL:</a></li>
<li><a href="#orgd428d09">How FastAPI Uses Starlette</a></li>
<li><a href="#org0fd209e">Example: Using FastAPI with Starlette Features</a></li>
<li><a href="#orgd0d6cac">Explanation</a></li>
</ul>
</li>
<li><a href="#orgb09cfdf">What is Pydantic and how FastAPI uses it for the data parts?</a>
<ul>
<li><a href="#orgea50c27">Key Features of Pydantic</a></li>
<li><a href="#orgd462525">How FastAPI Uses Pydantic</a></li>
<li><a href="#orgd88b7da">Example: Using Pydantic with FastAPI</a></li>
<li><a href="#orgeba0df1">Explanation</a></li>
<li><a href="#org1004dd9">Summary</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org6ddc63c" class="outline-2">
<h2 id="org6ddc63c">Zero-Shot</h2>
<div class="outline-text-2" id="text-org6ddc63c">
</div>
<div id="outline-container-org0c80afc" class="outline-3">
<h3 id="org0c80afc">General Definitions</h3>
<div class="outline-text-3" id="text-org0c80afc">
<blockquote>
<p>
From what I understand, FastAPI is a lightweight Python library
designed for the efficient development of web servers, specializing in
processing HTTP requests and returning data in JSON format. Am I
right?
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-markdown">Yes, you are correct! FastAPI is a modern, fast (high-performance) web
framework for building APIs with Python 3.6+ based on standard Python
type hints. Here are some key points about FastAPI that align with
your understanding and expand on it:

<span class="org-markdown-list">1.</span> <span class="org-markdown-markup">**</span><span class="org-markdown-bold">High Performance</span><span class="org-markdown-markup">**</span>: FastAPI is designed to be very fast and
   efficient, leveraging the asynchronous capabilities of Python and
   the performance of the Starlette framework and Pydantic library. It
   can handle a large number of simultaneous connections efficiently.

<span class="org-markdown-list">2.</span> <span class="org-markdown-markup">**</span><span class="org-markdown-bold">Type Hints and Data Validation</span><span class="org-markdown-markup">**</span>: FastAPI uses Python's type
   hints to provide automatic validation, serialization, and
   documentation of the request and response data. This makes
   development faster and easier, while reducing the likelihood of
   bugs.

<span class="org-markdown-list">3.</span> <span class="org-markdown-markup">**</span><span class="org-markdown-bold">Asynchronous Support</span><span class="org-markdown-markup">**</span>: It natively supports asynchronous
   programming, which is especially useful for I/O-bound and
   high-latency operations like database access and web requests.

<span class="org-markdown-list">4.</span> <span class="org-markdown-markup">**</span><span class="org-markdown-bold">Automatic Interactive Documentation</span><span class="org-markdown-markup">**</span>: FastAPI generates
   interactive API documentation using Swagger UI and ReDoc out of the
   box, which is incredibly useful for development and debugging.

<span class="org-markdown-list">5.</span> <span class="org-markdown-markup">**</span><span class="org-markdown-bold">Ease of Use</span><span class="org-markdown-markup">**</span>: FastAPI is designed to be easy to use and learn,
   without sacrificing flexibility and performance. It aims to provide
   a good developer experience with features like dependency injection
   and easy-to-write route handlers.

<span class="org-markdown-list">6.</span> <span class="org-markdown-markup">**</span><span class="org-markdown-bold">JSON Handling</span><span class="org-markdown-markup">**</span>: One of the core functionalities of FastAPI is
   handling JSON data efficiently. It automatically converts request
   payloads to Python objects and vice versa, making it ideal for
   building RESTful APIs.

Here's a simple example of a FastAPI application:

<span class="org-markdown-code"><span class="org-markdown-markup">```</span></span><span class="org-markdown-code"><span class="org-markdown-language-keyword">python</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">from fastapi import FastAPI</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">from pydantic import BaseModel</span></span>

<span class="org-markdown-code"><span class="org-markdown-pre">app = FastAPI()</span></span>

<span class="org-markdown-code"><span class="org-markdown-pre">class Item(BaseModel):</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">    name: str</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">    description: str = None</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">    price: float</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">    tax: float = None</span></span>

<span class="org-markdown-code"><span class="org-markdown-pre">@app.post("/items/")</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">async def create_item(item: Item):</span></span>
<span class="org-markdown-code"><span class="org-markdown-pre">    return item</span></span>
<span class="org-markdown-code"><span class="org-markdown-markup">```</span></span>

In this example:

<span class="org-markdown-list">-</span> The FastAPI instance is created using <span class="org-markdown-markup">`</span><span class="org-markdown-inline-code">FastAPI()</span><span class="org-markdown-markup">`</span>.
<span class="org-markdown-list">-</span> The <span class="org-markdown-markup">`</span><span class="org-markdown-inline-code">Item</span><span class="org-markdown-markup">`</span> model is defined using Pydantic <span class="org-markdown-markup">`</span><span class="org-markdown-inline-code">BaseModel</span><span class="org-markdown-markup">`</span>, which
  supports validation and data conversion.
<span class="org-markdown-list">-</span> The <span class="org-markdown-markup">`</span><span class="org-markdown-inline-code">create_item</span><span class="org-markdown-markup">`</span> function defines an endpoint that receives an
  <span class="org-markdown-markup">`</span><span class="org-markdown-inline-code">Item</span><span class="org-markdown-markup">`</span>, processes it (here, it just returns the same item), and it
  will automatically have the correct type validation and JSON
  handling.

For further reading and more detailed information, you can explore the
official FastAPI documentation: <span class="org-markdown-markup">[</span><span class="org-markdown-link">FastAPI</span>
<span class="org-markdown-link">Documentation</span><span class="org-markdown-markup">](</span><span class="org-markdown-url">https://fastapi.tiangolo.com/</span><span class="org-markdown-markup">)</span>. It covers comprehensive
details with examples and best practices.
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb9b5cf7" class="outline-3">
<h3 id="orgb9b5cf7">The Appropriate Answer Format Request</h3>
<div class="outline-text-3" id="text-orgb9b5cf7">
<blockquote>
<p>
I'm use Emacs with Org-mode and Babel, so can you format your answers
appropriately?
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-markdown">Sure! If you're using Emacs with Org-mode and Babel, I can format the
answer accordingly using Org-mode's syntax for code blocks and
structured text.

Here is the same information formatted for Org-mode with code blocks:
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a377b6" class="outline-3">
<h3 id="org1a377b6">Overview of FastAPI</h3>
<div class="outline-text-3" id="text-org1a377b6">
<p>
FastAPI is a modern, fast (high-performance) web framework for
building APIs with Python 3.6+ based on standard Python type hints.
</p>

<ul class="org-ul">
<li><b>High Performance</b>: FastAPI is designed to be very fast and
efficient, leveraging the asynchronous capabilities of Python and
the performance of the Starlette framework and Pydantic library. It
can handle a large number of simultaneous connections efficiently.</li>

<li><b>Type Hints and Data Validation</b>: FastAPI uses Python's type hints
to provide automatic validation, serialization, and documentation of
the request and response data. This makes development faster and
easier, while reducing the likelihood of bugs.</li>

<li><b>Asynchronous Support</b>: It natively supports asynchronous
programming, which is especially useful for I/O-bound and
high-latency operations like database access and web requests.</li>

<li><b>Automatic Interactive Documentation</b>: FastAPI generates
interactive API documentation using Swagger UI and ReDoc out of the
box, which is incredibly useful for development and debugging.</li>

<li><b>Ease of Use</b>: FastAPI is designed to be easy to use and learn,
without sacrificing flexibility and performance. It aims to provide
a good developer experience with features like dependency injection
and easy-to-write route handlers.</li>

<li><b>JSON Handling</b>: One of the core functionalities of FastAPI is
handling JSON data efficiently. It automatically converts request
payloads to Python objects and vice versa, making it ideal for
building RESTful APIs.</li>
</ul>
</div>
</div>

<div id="outline-container-org52d5833" class="outline-3">
<h3 id="org52d5833">Example FastAPI Application</h3>
<div class="outline-text-3" id="text-org52d5833">
<p>
Here is a simple example of a FastAPI application:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">from</span> fastapi <span class="org-keyword">import</span> FastAPI
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">from</span> pydantic <span class="org-keyword">import</span> BaseModel

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">app</span> = FastAPI()

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">class</span> <span class="org-type">Item</span>(BaseModel):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">name</span>: <span class="org-builtin">str</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> description: <span class="org-builtin">str</span> = <span class="org-constant">None</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">price</span>: <span class="org-builtin">float</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> tax: <span class="org-builtin">float</span> = <span class="org-constant">None</span>

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-type">@app.post</span>(<span class="org-string">"/items/"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">async def</span> <span class="org-function-name">create_item</span>(item: Item):
<span class="org-highlight-indentation"> </span>   <span class="org-highlight-indentation"> </span> <span class="org-keyword">return</span> item
</pre>
</div>

<p>
In this example:
</p>

<ul class="org-ul">
<li>The FastAPI instance is created using <code>FastAPI()</code>.</li>
<li>The <code>Item</code> model is defined using Pydantic <code>BaseModel</code>, which
supports validation and data conversion.</li>
<li>The <code>create_item</code> function defines an endpoint that receives an
<code>Item</code>, processes it (here, it just returns the same item), and it
will automatically have the correct type validation and JSON
handling.</li>
</ul>

<p>
For further reading and more detailed information, you can explore the
official FastAPI documentation: <a href="https://fastapi.tiangolo.com/">FastAPI Documentation</a>. It covers
comprehensive details with examples and best practices.
</p>



<p>
This should fit well with your Org-mode workflow in Emacs. You can
execute the Python code block directly in Org-mode using Babel if you
have it set up for Python.
</p>
</div>
</div>

<div id="outline-container-org2a374bd" class="outline-3">
<h3 id="org2a374bd">Additional Clarifications</h3>
<div class="outline-text-3" id="text-org2a374bd">
</div>
<div id="outline-container-org1e6fbe8" class="outline-4">
<h4 id="org1e6fbe8">What is RESTful API?</h4>
<div class="outline-text-4" id="text-org1e6fbe8">
<p>
A RESTful API (Representational State Transfer Application Programming
Interface) is a web API that adheres to the principles of REST
(Representational State Transfer), an architectural style defined by
computer scientist Roy Fielding in his doctoral dissertation. RESTful
APIs are designed to interact with resources in a stateless manner
over HTTP. Here are the key concepts and principles of RESTful APIs:
</p>

<ol class="org-ol">
<li><b>Resources and URIs</b>:
<ul class="org-ul">
<li>Resources, which can be any type of data (e.g., users, posts,
products), are identified by URLs (Uniform Resource Locators),
also known as URIs (Uniform Resource Identifiers).</li>
<li>Each resource is represented using a unique URL.</li>
</ul></li>

<li><b>HTTP Methods</b>:
<ul class="org-ul">
<li>RESTful APIs use standard HTTP methods to perform operations on
resources. The primary methods are:
<ul class="org-ul">
<li><code>GET</code>: Retrieve a representation of a resource.</li>
<li><code>POST</code>: Create a new resource.</li>
<li><code>PUT</code>: Update an existing resource.</li>
<li><code>DELETE</code>: Delete a resource.</li>
<li><code>PATCH</code>: Partially update a resource.</li>
</ul></li>
</ul></li>

<li><b>Statelessness</b>:
<ul class="org-ul">
<li>Each API call from the client to the server must contain all the
information needed to understand and process the request.</li>
<li>The server does not store any client context between requests,
making each request independent and self-contained.</li>
</ul></li>

<li><b>Representation</b>:
<ul class="org-ul">
<li>Resources are represented in different formats such as JSON, XML,
or HTML, but JSON is the most common format.</li>
<li>The server provides the necessary information in response to the
client's request in the appropriate representation format.</li>
</ul></li>

<li><b>Client-Server Architecture</b>:
<ul class="org-ul">
<li>The client and server are separated, allowing both to be
developed and scaled independently.</li>
<li>The server handles the business logic and data storage, while the
client handles the user interface and user interactions.</li>
</ul></li>

<li><b>Cacheability</b>:
<ul class="org-ul">
<li>Responses can be marked as cacheable or non-cacheable to improve
performance and scalability.</li>
<li>Proper use of caching can reduce the number of requests the
client makes to the server.</li>
</ul></li>

<li><b>Layered System</b>:
<ul class="org-ul">
<li>RESTful APIs can be designed to work with intermediaries such as
proxies, gateways, and load balancers to improve scalability,
security, and performance.</li>
</ul></li>

<li><b>Uniform Interface</b>:
<ul class="org-ul">
<li>RESTful APIs have a consistent and predictable interface with
standardized URIs and HTTP methods, making it easier for
developers to understand and use the API.</li>
</ul></li>
</ol>

<p>
Here's an example of a RESTful API using FastAPI that manages a
collection of items:
</p>
</div>

<div id="outline-container-orgfedbad0" class="outline-5">
<h5 id="orgfedbad0">Example of a RESTful API using FastAPI</h5>
<div class="outline-text-5" id="text-orgfedbad0">
<div class="org-src-container">
<pre class="src src-python"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">from</span> fastapi <span class="org-keyword">import</span> FastAPI, HTTPException
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">from</span> pydantic <span class="org-keyword">import</span> BaseModel
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">from</span> typing <span class="org-keyword">import</span> List

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">app</span> = FastAPI()

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">class</span> <span class="org-type">Item</span>(BaseModel):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">name</span>: <span class="org-builtin">str</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> description: <span class="org-builtin">str</span> = <span class="org-constant">None</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">price</span>: <span class="org-builtin">float</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> tax: <span class="org-builtin">float</span> = <span class="org-constant">None</span>

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-variable-name">items</span> = []

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-type">@app.get</span>(<span class="org-string">"/items/"</span>, response_model=List[Item])
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">async def</span> <span class="org-function-name">read_items</span>():
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">return</span> items

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-type">@app.post</span>(<span class="org-string">"/items/"</span>, response_model=Item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">async def</span> <span class="org-function-name">create_item</span>(item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> items.append(item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">return</span> item

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-type">@app.get</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">async def</span> <span class="org-function-name">read_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">return</span> items[item_id]

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-type">@app.put</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">async def</span> <span class="org-function-name">update_item</span>(item_id: <span class="org-builtin">int</span>, item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> items[<span class="org-variable-name">item_id</span>] = item
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">return</span> item

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-type">@app.delete</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">async def</span> <span class="org-function-name">delete_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span> <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"> </span>   <span class="org-highlight-indentation"> </span> <span class="org-keyword">return</span> items.pop(item_id)
</pre>
</div>


<p>
This example demonstrates a simple RESTful API with the following endpoints:
</p>

<ul class="org-ul">
<li><code>GET /items/</code>: Retrieve a list of items.</li>
<li><code>POST /items/</code>: Create a new item.</li>
<li><code>GET /items/{item_id}</code>: Retrieve a specific item by its ID.</li>
<li><code>PUT /items/{item_id}</code>: Update a specific item by its ID.</li>
<li><code>DELETE /items/{item_id}</code>: Delete a specific item by its ID.</li>
</ul>

<p>
The FastAPI framework makes it easy to create these endpoints, handle
validation, and return proper responses.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd365e29" class="outline-4">
<h4 id="orgd365e29">Babel Subtleties</h4>
<div class="outline-text-4" id="text-orgd365e29">
<blockquote>
<p>
I want to ask you do not use = :results output :session = further in
Babel code snippets because I've already defined these properties in a
file header.
</p>

<p>
So, can you suggest how to test <code>Example of a RESTful API using
FastAPI</code> using <code>unittest</code> module inside Emacs:
</p>
<ul class="org-ul">
<li>How to launch <code>FastAPI</code> application in Emacs;</li>
<li>How to launch <code>unittest</code> to vefiry correctness of its functioning.</li>
</ul>
</blockquote>


<p>
Sure, we can go through the steps to achieve this in Emacs using
Org-mode, Babel, and the <code>unittest</code> module in Python. Below are the
steps and code snippets to help you test a FastAPI application using
<code>unittest</code> within Emacs.
</p>
</div>

<div id="outline-container-org3b251c0" class="outline-5">
<h5 id="org3b251c0">Steps to Test FastAPI Application Using unittest</h5>
<div class="outline-text-5" id="text-org3b251c0">
<ol class="org-ol">
<li><b>Define the FastAPI Application</b>: You already have the FastAPI
application defined. We will place this code in an Org-mode code
block.</li>

<li><b>Create Unit Tests Using unittest</b>: We will write unit tests to
verify the correctness of the FastAPI application.</li>

<li><b>Launch the FastAPI Application</b>: We will launch the FastAPI
application in a separate Org-mode code block, which simulates
running the server.</li>

<li><b>Run the Unit Tests</b>: We will then execute the unit tests to
ensure everything is functioning correctly.</li>
</ol>

<p>
Here is how you can structure it in your Org-mode file:
</p>
</div>
</div>

<div id="outline-container-org6326c58" class="outline-5">
<h5 id="org6326c58">FastAPI Application</h5>
<div class="outline-text-5" id="text-org6326c58">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> fastapi <span class="org-keyword">import</span> FastAPI, HTTPException
<span class="org-keyword">from</span> pydantic <span class="org-keyword">import</span> BaseModel
<span class="org-keyword">from</span> typing <span class="org-keyword">import</span> List

<span class="org-variable-name">app</span> = FastAPI()

<span class="org-keyword">class</span> <span class="org-type">Item</span>(BaseModel):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">name</span>: <span class="org-builtin">str</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   description: <span class="org-builtin">str</span> = <span class="org-constant">None</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">price</span>: <span class="org-builtin">float</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   tax: <span class="org-builtin">float</span> = <span class="org-constant">None</span>

<span class="org-variable-name">items</span> = []

<span class="org-type">@app.get</span>(<span class="org-string">"/items/"</span>, response_model=List[Item])
<span class="org-keyword">async def</span> <span class="org-function-name">read_items</span>():
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items

<span class="org-type">@app.post</span>(<span class="org-string">"/items/"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">create_item</span>(item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items.append(item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.get</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">read_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items[item_id]

<span class="org-type">@app.put</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">update_item</span>(item_id: <span class="org-builtin">int</span>, item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items[<span class="org-variable-name">item_id</span>] = item
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.delete</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">delete_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"> </span>   <span class="org-keyword">return</span> items.pop(item_id)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4dbca9" class="outline-5">
<h5 id="orgb4dbca9">Unit Tests for FastAPI Application</h5>
<div class="outline-text-5" id="text-orgb4dbca9">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> unittest
<span class="org-keyword">from</span> fastapi.testclient <span class="org-keyword">import</span> TestClient

<span class="org-comment-delimiter"># </span><span class="org-comment">Import the FastAPI ~app~ from the code block above</span>
<span class="org-keyword">from</span> __main__ <span class="org-keyword">import</span> app

<span class="org-variable-name">client</span> = TestClient(app)

<span class="org-keyword">class</span> <span class="org-type">TestFastAPI</span>(unittest.TestCase):

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">def</span> <span class="org-function-name">test_create_item</span>(<span class="org-keyword">self</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">response</span> = client.post(<span class="org-string">"/items/"</span>, json={<span class="org-string">"name"</span>: <span class="org-string">"Test Item"</span>, <span class="org-string">"price"</span>: 10.5})
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.status_code, 200)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.json()[<span class="org-string">"name"</span>, <span class="org-string">"Test Item"</span>])

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">def</span> <span class="org-function-name">test_read_items</span>(<span class="org-keyword">self</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   response = client.get(<span class="org-string">"/items/"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.status_code, 200)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertIsInstance(response.json(), <span class="org-builtin">list</span>)

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">def</span> <span class="org-function-name">test_update_item</span>(<span class="org-keyword">self</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   client.post(<span class="org-string">"/items/"</span>, json={<span class="org-string">"name"</span>: <span class="org-string">"Test Item"</span>, <span class="org-string">"price"</span>: 10.5})
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   response = client.put(<span class="org-string">"/items/0"</span>, json={<span class="org-string">"name"</span>: <span class="org-string">"Updated Item"</span>, <span class="org-string">"price"</span>: 15.0})
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.status_code, 200)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.json()[<span class="org-string">"name"</span>], <span class="org-string">"Updated Item"</span>)

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">def</span> <span class="org-function-name">test_delete_item</span>(<span class="org-keyword">self</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   client.post(<span class="org-string">"/items/"</span>, json={<span class="org-string">"name"</span>: <span class="org-string">"Test Item"</span>, <span class="org-string">"price"</span>: 10.5})
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   response = client.delete(<span class="org-string">"/items/0"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.status_code, 200)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.json()[<span class="org-string">"name"</span>], <span class="org-string">"Test Item"</span>)

<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">def</span> <span class="org-function-name">test_read_nonexistent_item</span>(<span class="org-keyword">self</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   response = client.get(<span class="org-string">"/items/999"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">self</span>.assertEqual(response.status_code, 404)

<span class="org-keyword">if</span> <span class="org-builtin">__name__</span> == <span class="org-string">"__main__"</span>:
<span class="org-highlight-indentation"> </span>   unittest.main()
</pre>
</div>
</div>
</div>

<div id="outline-container-org57e23ce" class="outline-5">
<h5 id="org57e23ce">Launch FastAPI Application</h5>
<div class="outline-text-5" id="text-org57e23ce">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> uvicorn

<span class="org-keyword">if</span> <span class="org-builtin">__name__</span> == <span class="org-string">"__main__"</span>:
<span class="org-highlight-indentation"> </span>   uvicorn.run(app, host=<span class="org-string">"127.0.0.1"</span>, port=8000)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ba52f3" class="outline-5">
<h5 id="org7ba52f3">Run Unit Tests</h5>
<div class="outline-text-5" id="text-org7ba52f3">
<div class="org-src-container">
<pre class="src src-python">!pytest test_api.py
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0529b15" class="outline-4">
<h4 id="org0529b15">Explanation</h4>
<div class="outline-text-4" id="text-org0529b15">
<ol class="org-ol">
<li><b>FastAPI Application</b>: The first code block contains the FastAPI
application code.</li>

<li><b>Unit Tests</b>: The second code block contains the <code>unittest</code>
implementation. We use <code>TestClient</code> from <code>fastapi.testclient</code> to
simulate requests to the FastAPI application. Each method in the
<code>TestFastAPI</code> class corresponds to a test case for different API
operations.</li>

<li><b>Launch FastAPI Application</b>: This block will launch the FastAPI
application using <code>uvicorn</code>. It's marked with <code>:eval no</code> to prevent
accidental execution. You can run this in a terminal.</li>

<li><b>Run Unit Tests</b>: This block uses <code>pytest</code> to run the unit
tests. You can simply execute this block to see the test results.</li>
</ol>

<p>
To execute the above workflow in Emacs with Org-mode:
</p>

<ol class="org-ol">
<li><b>Start FastAPI Server</b>: You can manually run the "Launch FastAPI
Application" block in a separate terminal to start the FastAPI
server.</li>

<li><b>Execute Unit Tests</b>: Evaluate the "Run Unit Tests" block to run
your test cases and verify the functionality of your FastAPI
application.</li>
</ol>

<p>
This setup will help you develop and test a RESTful API using FastAPI
and <code>unittest</code> within Emacs efficiently.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org5a06325" class="outline-2">
<h2 id="org5a06325">What is the purpose of usage of FastAPI?</h2>
<div class="outline-text-2" id="text-org5a06325">
<p>
The purpose of using FastAPI is to provide a high-performance,
easy-to-use web framework for building APIs with Python. It is
designed to make the development of web services efficient and
enjoyable, offering several benefits that address common needs and
challenges faced by developers. Here are some key purposes and
advantages of FastAPI:
</p>

<p>
<b>Key Purposes and Advantages of FastAPI</b>
</p>
</div>

<div id="outline-container-org8e5febf" class="outline-3">
<h3 id="org8e5febf"><b>High Performance</b>:</h3>
<div class="outline-text-3" id="text-org8e5febf">
<ul class="org-ul">
<li>FastAPI is built on Starlette for the web parts and Pydantic for
the data parts, both of which are extremely performant
frameworks.
<ul class="org-ul">
<li>It is designed to handle a large number of simultaneous requests
efficiently, making it suitable for high-load scenarios.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org60cef72" class="outline-3">
<h3 id="org60cef72">Developer Productivity:</h3>
<div class="outline-text-3" id="text-org60cef72">
<ul class="org-ul">
<li>FastAPI uses Python’s type hints to automatically generate
validation, serialization, and documentation, reducing
boilerplate code and speeding up development.</li>
<li>The automatic generation of OpenAPI and JSON Schema documentation
helps in creating self-documenting APIs, which can be explored
using interactive tools like Swagger UI and ReDoc.</li>
</ul>
</div>
</div>

<div id="outline-container-org7042733" class="outline-3">
<h3 id="org7042733">Ease of Use:</h3>
<div class="outline-text-3" id="text-org7042733">
<ul class="org-ul">
<li>The framework is designed to be intuitive, with a clear and
concise API, making it easy for beginners to pick up and for
experienced developers to be productive quickly.</li>
<li>FastAPI provides a straightforward way to define both synchronous
and asynchronous endpoints using Python’s native async/await
syntax.</li>
</ul>
</div>
</div>

<div id="outline-container-orgf90a4d3" class="outline-3">
<h3 id="orgf90a4d3">Data Validation and Serialization:</h3>
<div class="outline-text-3" id="text-orgf90a4d3">
<ul class="org-ul">
<li>Using Pydantic, FastAPI ensures that the data entering your API
meets the defined type constraints. This prevents many common
bugs related to data handling.</li>
<li>It automatically handles JSON serialization and deserialization, simplifying the process of working with JSON data.</li>
</ul>
</div>
</div>

<div id="outline-container-orgd36d1f1" class="outline-3">
<h3 id="orgd36d1f1">Asynchronous Support:</h3>
<div class="outline-text-3" id="text-orgd36d1f1">
<ul class="org-ul">
<li>Built-in support for asynchronous programming allows for
non-blocking operations, which is particularly useful for
I/O-bound tasks like database queries, network requests, etc.</li>
<li>FastAPI makes it easy to convert from synchronous to asynchronous
applications, leveraging Python's <code>async</code> and <code>await</code> keywords.</li>
</ul>
</div>
</div>

<div id="outline-container-orgb29c4c3" class="outline-3">
<h3 id="orgb29c4c3">Dependency Injection:</h3>
<div class="outline-text-3" id="text-orgb29c4c3">
<ul class="org-ul">
<li>FastAPI includes a simple but powerful dependency injection
system that allows you to manage and inject dependencies easily.</li>
<li>This promotes clean, modular code and makes it easier to manage
cross-cutting concerns like database connections, authentication,
etc.</li>
</ul>
</div>
</div>

<div id="outline-container-orgb0dbf0b" class="outline-3">
<h3 id="orgb0dbf0b">Interactive API Documentation:</h3>
<div class="outline-text-3" id="text-orgb0dbf0b">
<ul class="org-ul">
<li>By default, FastAPI provides interactive API documentation
through Swagger UI and ReDoc. This makes testing and exploring
the API straightforward and comprehensive.</li>
<li>These tools are invaluable for developers, allowing them to
interact with endpoints directly from the browser.</li>
</ul>
</div>
</div>

<div id="outline-container-org355ebaf" class="outline-3">
<h3 id="org355ebaf">Security:</h3>
<div class="outline-text-3" id="text-org355ebaf">
<ul class="org-ul">
<li>FastAPI includes easy-to-use tools for handling security,
including OAuth2, JWT tokens, and scopes.</li>
<li>Security dependencies can be included with the same dependency
injection system, keeping the security implementations clean and
manageable.</li>
</ul>
</div>
</div>

<div id="outline-container-orgc819e43" class="outline-3">
<h3 id="orgc819e43">Example Purposes</h3>
<div class="outline-text-3" id="text-orgc819e43">
<p>
Here are some common use cases where FastAPI is particularly advantageous:
</p>

<ul class="org-ul">
<li><b>Microservices</b>: Building microservices that handle JSON payloads
efficiently.</li>
<li><b>Data-Driven APIs</b>: Creating RESTful APIs to interface with data
stores (SQL or NoSQL databases).</li>
<li><b>ML and AI</b>: Serving machine learning models or AI services through
an API.</li>
<li><b>WebSockets</b>: Implementing real-time communication features (like
chat applications) with WebSockets support.</li>
<li><b>Prototyping</b>: Quickly prototyping and iterating over API designs
before final implementation.</li>
</ul>
</div>
</div>

<div id="outline-container-org0b21e43" class="outline-3">
<h3 id="org0b21e43">Example of FastAPI Usage</h3>
<div class="outline-text-3" id="text-org0b21e43">
<p>
Below is a simple example to illustrate how FastAPI can be used to
create a RESTful API:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> fastapi <span class="org-keyword">import</span> FastAPI
<span class="org-keyword">from</span> pydantic <span class="org-keyword">import</span> BaseModel
<span class="org-keyword">from</span> typing <span class="org-keyword">import</span> List

<span class="org-variable-name">app</span> = FastAPI()

<span class="org-keyword">class</span> <span class="org-type">Item</span>(BaseModel):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">name</span>: <span class="org-builtin">str</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   description: <span class="org-builtin">str</span> = <span class="org-constant">None</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">price</span>: <span class="org-builtin">float</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   tax: <span class="org-builtin">float</span> = <span class="org-constant">None</span>

<span class="org-variable-name">items</span> = []

<span class="org-type">@app.get</span>(<span class="org-string">"/items/"</span>, response_model=List[Item])
<span class="org-keyword">async def</span> <span class="org-function-name">read_items</span>():
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items

<span class="org-type">@app.post</span>(<span class="org-string">"/items/"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">create_item</span>(item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items.append(item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.get</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">read_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items[item_id]

<span class="org-type">@app.put</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">update_item</span>(item_id: <span class="org-builtin">int</span>, item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items[<span class="org-variable-name">item_id</span>] = item
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.delete</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">delete_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"> </span>   <span class="org-keyword">return</span> items.pop(item_id)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e94918" class="outline-3">
<h3 id="org7e94918">Summary</h3>
<div class="outline-text-3" id="text-org7e94918">
<p>
In summary, FastAPI is used to create fast, robust, and maintainable
APIs with minimal effort, high performance, and excellent developer
experience. It is particularly suitable for modern web applications,
microservices, and tasks requiring efficient I/O operations.
</p>
</div>
</div>
</div>

<div id="outline-container-org6ae96ea" class="outline-2">
<h2 id="org6ae96ea">What is Starlette framework and how it used in FastAPI?</h2>
<div class="outline-text-2" id="text-org6ae96ea">
<p>
<b>Starlette</b> is an ASGI (Asynchronous Server Gateway Interface)
framework designed for building web applications. It's lightweight and
focuses on providing the essential tools needed for web applications,
such as routing, middleware, and session handling, among other
features. FastAPI leverages Starlette for its web server parts,
meaning that FastAPI extends Starlette and incorporates it as the
underlying framework for handling HTTP requests and ASGI applications.
</p>

<p>
<b>Key Features of Starlette</b>
</p>
</div>

<div id="outline-container-org2ce3255" class="outline-3">
<h3 id="org2ce3255">ASGI Support:</h3>
<div class="outline-text-3" id="text-org2ce3255">
<p>
Starlette is built to support ASGI (the asynchronous successor to
WSGI). This enables asynchronous request handling, allowing for better
performance in I/O-bound and concurrent operations.
</p>
</div>
</div>

<div id="outline-container-org8df5df2" class="outline-3">
<h3 id="org8df5df2">Routing:</h3>
<div class="outline-text-3" id="text-org8df5df2">
<p>
Starlette provides an easy and powerful routg mechanism which lets you
map URLs to endpoints (functions or class-based views).
</p>
</div>
</div>

<div id="outline-container-orgb38b3cc" class="outline-3">
<h3 id="orgb38b3cc">Middleware:</h3>
<div class="outline-text-3" id="text-orgb38b3cc">
<p>
Starlette supports middleware, which are hooks that intercept
requests and responses at different stages for various purposes
(e.g., logging, security checks, etc.).
</p>
</div>
</div>

<div id="outline-container-org51f102e" class="outline-3">
<h3 id="org51f102e">Session Management:</h3>
<div class="outline-text-3" id="text-org51f102e">
<p>
Starlette includes built-in support for session management, which
is essential for maintaining user states.
</p>
</div>
</div>

<div id="outline-container-org2ec515e" class="outline-3">
<h3 id="org2ec515e">Authentication:</h3>
<div class="outline-text-3" id="text-org2ec515e">
<p>
Starlette provides authentication tools and utility functions,
making it easy to implement user authentication and authorization.
</p>
</div>
</div>

<div id="outline-container-org018774a" class="outline-3">
<h3 id="org018774a">WebSockets:</h3>
<div class="outline-text-3" id="text-org018774a">
<p>
Starlette has built-in support for WebSockets, which is useful for
real-time, bidirectional communication between clients and servers.
</p>
</div>
</div>

<div id="outline-container-org299c2ca" class="outline-3">
<h3 id="org299c2ca">GraphQL:</h3>
<div class="outline-text-3" id="text-org299c2ca">
<p>
Starlette supports GraphQL via integration with libraries such as
Graphene, making it flexible for various API paradigms.
</p>
</div>
</div>

<div id="outline-container-orgd428d09" class="outline-3">
<h3 id="orgd428d09">How FastAPI Uses Starlette</h3>
<div class="outline-text-3" id="text-orgd428d09">
<p>
FastAPI builds on Starlette to provide a more comprehensive framework
specifically aimed at creating APIs with Python. The key
functionalities that FastAPI inherits from Starlette and expands upon
include:
</p>

<ul class="org-ul">
<li><b>Routing</b>: FastAPI uses Starlette's routing capabilities but adds
features for parameterized routes, path parameters, and dependency
injection.</li>
<li><b>Middleware</b>: FastAPI fully supports Starlette's middleware
functionalities and adds its own set of middleware for tasks like
request validation and security.</li>
<li><b>Requests and Responses</b>: FastAPI extends the request and response
handling to include data validation, automatic
serialization/deserialization using Pydantic.</li>
<li><b>WebSockets and Background Tasks</b>: FastAPI supports WebSockets and
background tasks via Starlette, making it easier to build real-time
applications.</li>
<li><b>Exception Handling</b>: FastAPI uses Starlette's exception handling
mechanisms, making it simple to define custom error responses.</li>
<li><b>Static Files</b>: FastAPI can serve static files through Starlette's
static file serving tools.</li>
</ul>

<p>
In essence, FastAPI extends Starlette's capabilities with additional
layers of abstraction that make it easier to build APIs, focusing
mainly on rapid development and type safety.
</p>
</div>
</div>

<div id="outline-container-org0fd209e" class="outline-3">
<h3 id="org0fd209e">Example: Using FastAPI with Starlette Features</h3>
<div class="outline-text-3" id="text-org0fd209e">
<p>
Here's a simple example demonstrating how FastAPI utilizes some of Starlette's features:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> fastapi <span class="org-keyword">import</span> FastAPI, HTTPException, Request
<span class="org-keyword">from</span> pydantic <span class="org-keyword">import</span> BaseModel
<span class="org-keyword">from</span> starlette.middleware.sessions <span class="org-keyword">import</span> SessionMiddleware
<span class="org-keyword">from</span> starlette.staticfiles <span class="org-keyword">import</span> StaticFiles

<span class="org-variable-name">app</span> = FastAPI()

<span class="org-comment-delimiter"># </span><span class="org-comment">Adding session middleware</span>
app.add_middleware(SessionMiddleware, secret_key=<span class="org-string">"!secret"</span>)

<span class="org-keyword">class</span> <span class="org-type">Item</span>(BaseModel):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   name: <span class="org-builtin">str</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   description: <span class="org-builtin">str</span> = <span class="org-constant">None</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   price: <span class="org-builtin">float</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   tax: <span class="org-builtin">float</span> = <span class="org-constant">None</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">In-memory items storage</span>
items = []

<span class="org-type">@app.get</span>(<span class="org-string">"/items/"</span>)
<span class="org-keyword">async def</span> <span class="org-function-name">read_items</span>():
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items

<span class="org-type">@app.post</span>(<span class="org-string">"/items/"</span>)
<span class="org-keyword">async def</span> <span class="org-function-name">create_item</span>(item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items.append(item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.get</span>(<span class="org-string">"/items/{item_id}"</span>)
<span class="org-keyword">async def</span> <span class="org-function-name">read_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items[item_id]

<span class="org-type">@app.put</span>(<span class="org-string">"/items/{item_id}"</span>)
<span class="org-keyword">async def</span> <span class="org-function-name">update_item</span>(item_id: <span class="org-builtin">int</span>, item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items[<span class="org-variable-name">item_id</span>] = item
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.delete</span>(<span class="org-string">"/items/{item_id}"</span>)
<span class="org-keyword">async def</span> <span class="org-function-name">delete_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items.pop(item_id)

<span class="org-comment-delimiter"># </span><span class="org-comment">Mounting static files, for example, serving files from 'static' directory</span>
app.mount(<span class="org-string">"/static"</span>, StaticFiles(directory=<span class="org-string">"static"</span>), name=<span class="org-string">"static"</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">Example of middleware that logs requests</span>
<span class="org-type">@app.middleware</span>(<span class="org-string">"http"</span>)
<span class="org-keyword">async def</span> <span class="org-function-name">log_requests</span>(request: Request, call_next):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-builtin">print</span>(f<span class="org-string">"Request URL: </span>{request.url}<span class="org-string">"</span>)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   response = <span class="org-keyword">await</span> call_next(request)
<span class="org-highlight-indentation"> </span>   <span class="org-keyword">return</span> response
</pre>
</div>
</div>
</div>


<div id="outline-container-orgd0d6cac" class="outline-3">
<h3 id="orgd0d6cac">Explanation</h3>
<div class="outline-text-3" id="text-orgd0d6cac">
<ol class="org-ol">
<li><b>Session Middleware</b>:
<ul class="org-ul">
<li>We add a session middleware to handle session management, using
Starlette's <code>SessionMiddleware</code>.</li>
</ul></li>

<li><b>CRUD Operations</b>:
<ul class="org-ul">
<li>Demonstrates basic CRUD operations on items, using FastAPI’s
routing and data validation.</li>
</ul></li>

<li><b>Static Files</b>:
<ul class="org-ul">
<li>Serves static files using Starlette’s <code>StaticFiles</code>.</li>
</ul></li>

<li><b>Custom Middleware</b>:
<ul class="org-ul">
<li>Example of logging middleware that prints the URL of incoming
requests, showcasing how easy it is to implement custom
middleware.</li>
</ul></li>
</ol>

<p>
By combining FastAPI with the robust features of Starlette, you can
efficiently build scalable and high-performance web
applications. FastAPI not only makes it easier but also ensures that
you adhere to best practices and modern web standards.
</p>
</div>
</div>
</div>



<div id="outline-container-orgb09cfdf" class="outline-2">
<h2 id="orgb09cfdf">What is Pydantic and how FastAPI uses it for the data parts?</h2>
<div class="outline-text-2" id="text-orgb09cfdf">
<p>
<b>Pydantic</b> is a data validation and parsing library for Python. It
uses Python type annotations to perform data validation and type
coercion, making it easy to ensure that input data conforms to
expected types and structures. Pydantic is highly efficient and
provides a clean, declarative way to define data models.
</p>
</div>

<div id="outline-container-orgea50c27" class="outline-3">
<h3 id="orgea50c27">Key Features of Pydantic</h3>
<div class="outline-text-3" id="text-orgea50c27">
<ol class="org-ol">
<li><b>Type Validation</b>:
<ul class="org-ul">
<li>Pydantic validates the data against the types specified in the
class annotations. If the data does not match the expected type,
Pydantic will raise a validation error.</li>
</ul></li>

<li><b>Type Coercion</b>:
<ul class="org-ul">
<li>Pydantic can coerce different types into the expected format if
they are convertible. For example, a string that represents an
integer can be automatically converted to an integer type.</li>
</ul></li>

<li><b>Nested Models</b>:
<ul class="org-ul">
<li>Pydantic supports nested data models, allowing complex data
validation and serialization to be managed hierarchically.</li>
</ul></li>

<li><b>Data Serialization and Deserialization</b>:
<ul class="org-ul">
<li>Pydantic can serialize and deserialize data easily, converting
Python objects into JSON-compatible dictionaries and vice versa.</li>
</ul></li>

<li><b>Default Values</b>:
<ul class="org-ul">
<li>You can specify default values for fields in your models, which
will be used if the corresponding data is missing.</li>
</ul></li>

<li><b>Custom Validation</b>:
<ul class="org-ul">
<li>Pydantic allows for custom validation methods, enabling more
complex validation logic where necessary.</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orgd462525" class="outline-3">
<h3 id="orgd462525">How FastAPI Uses Pydantic</h3>
<div class="outline-text-3" id="text-orgd462525">
<p>
FastAPI integrates Pydantic to handle the data parts of the
API. Specifically, FastAPI uses Pydantic for:
</p>

<ol class="org-ol">
<li><b>Request Validation</b>:
<ul class="org-ul">
<li>FastAPI uses Pydantic models to validate the data sent in HTTP
requests. When defining endpoints, you can specify that they
accept Pydantic models as parameters, and FastAPI will
automatically validate the incoming request data against these
models.</li>
</ul></li>

<li><b>Response Serialization</b>:
<ul class="org-ul">
<li>When returning data from your endpoints, you can use Pydantic
models to ensure that the response data adheres to a particular
structure. FastAPI will serialize the response data using the
specified Pydantic model.</li>
</ul></li>

<li><b>Automatic Documentation</b>:
<ul class="org-ul">
<li>Pydantic models are used to generate OpenAPI schema definitions
automatically. This means that the request and response data
structures are documented in the interactive API docs (Swagger UI
and ReDoc) without any additional effort from the developer.</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orgd88b7da" class="outline-3">
<h3 id="orgd88b7da">Example: Using Pydantic with FastAPI</h3>
<div class="outline-text-3" id="text-orgd88b7da">
<p>
Here's a simple example to illustrate how FastAPI uses Pydantic models
for request validation and response serialization:
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> fastapi <span class="org-keyword">import</span> FastAPI, HTTPException
<span class="org-keyword">from</span> pydantic <span class="org-keyword">import</span> BaseModel
<span class="org-keyword">from</span> typing <span class="org-keyword">import</span> List

<span class="org-variable-name">app</span> = FastAPI()

<span class="org-comment-delimiter"># </span><span class="org-comment">Define a Pydantic model for an Item</span>
<span class="org-keyword">class</span> <span class="org-type">Item</span>(BaseModel):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">name</span>: <span class="org-builtin">str</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   description: <span class="org-builtin">str</span> = <span class="org-constant">None</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-variable-name">price</span>: <span class="org-builtin">float</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   tax: <span class="org-builtin">float</span> = <span class="org-constant">None</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">In-memory items storage</span>
<span class="org-variable-name">items</span> = []

<span class="org-type">@app.post</span>(<span class="org-string">"/items/"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">create_item</span>(item: Item):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-doc">"""</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   Create a new item.</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   The request body is validated against the ~Item~ Pydantic model.</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   """</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   items.append(item)
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> item

<span class="org-type">@app.get</span>(<span class="org-string">"/items/"</span>, response_model=List[Item])
<span class="org-keyword">async def</span> <span class="org-function-name">read_items</span>():
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-doc">"""</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   Retrieve all items.</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   The response body is serialized using the ~Item~ Pydantic model.</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   """</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">return</span> items

<span class="org-type">@app.get</span>(<span class="org-string">"/items/{item_id}"</span>, response_model=Item)
<span class="org-keyword">async def</span> <span class="org-function-name">read_item</span>(item_id: <span class="org-builtin">int</span>):
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-doc">"""</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   Retrieve a specific item by ID.</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   The response body is serialized using the ~Item~ Pydantic model.</span>
<span class="org-doc"><span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span></span><span class="org-doc">   """</span>
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">if</span> item_id &gt;= <span class="org-builtin">len</span>(items) <span class="org-keyword">or</span> item_id &lt; 0:
<span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-highlight-indentation"><span class="org-highlight-indentation"> </span></span>   <span class="org-keyword">raise</span> HTTPException(status_code=404, detail=<span class="org-string">"Item not found"</span>)
<span class="org-highlight-indentation"> </span>   <span class="org-keyword">return</span> items[item_id]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeba0df1" class="outline-3">
<h3 id="orgeba0df1">Explanation</h3>
<div class="outline-text-3" id="text-orgeba0df1">
<ol class="org-ol">
<li><b>Request Validation</b>:
<ul class="org-ul">
<li>The <code>create_item</code> endpoint takes an <code>Item</code> model as a
parameter. FastAPI uses the Pydantic model to validate the data
in the POST request body. If the data does not conform to the
<code>Item</code> model, FastAPI returns a 422 Unprocessable Entity response
with details about the validation errors.</li>
</ul></li>

<li><b>Response Serialization</b>:
<ul class="org-ul">
<li>The <code>read_items</code> and <code>read_item</code> endpoints return data that is
automatically serialized using the <code>Item</code> Pydantic model. This
ensures that the response data conforms to the expected
structure.</li>
</ul></li>

<li><b>Automatic Documentation</b>:
<ul class="org-ul">
<li>Pydantic models used in request bodies and response models are
automatically included in the OpenAPI schema generated by
FastAPI. This results in detailed, interactive API documentation.</li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-org1004dd9" class="outline-3">
<h3 id="org1004dd9">Summary</h3>
<div class="outline-text-3" id="text-org1004dd9">
<p>
<b>Pydantic</b> is a powerful tool for data validation and serialization in
Python. FastAPI leverages Pydantic to handle the data validation and
serialization parts of the API seamlessly. This makes FastAPI not only
high-performance but also developer-friendly, enabling rapid
development of robust and reliable APIs.  #+end_src
</p>
</div>
</div>
</div>
