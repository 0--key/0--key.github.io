---
layout: post
title: Pytest
tagline: " module overview"
permalink: /python/testing/pytest-in-babel.html
categories: [python, pytest, literate programming]
tags: [emacs, babel, tutorial, testing]
---
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">Definition</a></li>
<li><a href="#orgheadline2">Documentation</a></li>
<li><a href="#orgheadline3">Prerequisites</a></li>
<li><a href="#orgheadline4">Working sample</a>
<ul>
<li><a href="#orgheadline5">Lets create a separate test file:</a></li>
<li><a href="#orgheadline6">Run pytest</a></li>
<li><a href="#orgheadline7">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">Definition</h2>
<div class="outline-text-2" id="text-orgheadline1">
<blockquote>
<p>
<i>pytest: helps you write better programs</i>
</p>

<p>
The pytest framework makes it easy to write small tests, yet scales
to support complex functional testing for applications and
libraries.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2">Documentation</h2>
<div class="outline-text-2" id="text-orgheadline2">
<p>
At the <a href="http://docs.pytest.org/en/latest/">official web-site</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3">Prerequisites</h2>
<div class="outline-text-2" id="text-orgheadline3">
<p>
Check up does pytest installed already:
</p>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #ff0087;">#+BEGIN_SRC sh :results ouput pp :exports both</span>
pip freeze | grep pytest
<span style="color: #ff0087;">#+END_SRC</span>

<span style="color: #ff0087;">#+RESULTS:</span>
<span style="color: #b2b2b2;">: pytest==3.0.2</span>
</pre>
</div>

<p>
Seems like it's installed properly and we going on.
</p>
<blockquote>
<p>
<b>Tip</b> If you got an empty string as a result of code execution above
 it signed on necessity to install pytest.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4">Working sample</h2>
<div class="outline-text-2" id="text-orgheadline4">
</div><div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5">Lets create a separate test file:</h3>
<div class="outline-text-3" id="text-orgheadline5">
<div class="org-src-container">

<pre class="src src-org"><span style="color: #ff0087;">#+BEGIN_SRC python :noweb yes :tangle tests/test_sample.py</span>
  <span style="color: #00cdcd;">"""This is an initial pytest sample file"""</span>

  <span style="color: #cd0000;">def</span> <span style="color: #af00ff;">func</span>(x):
      <span style="color: #cd0000;">return</span> x + 1


  <span style="color: #cd0000;">def</span> <span style="color: #af00ff;">test_answer</span>():
      <span style="color: #cd0000;">assert</span> func(3) == 5
<span style="color: #ff0087;">#+END_SRC</span>
</pre>
</div>

<blockquote>
<p>
<b>Tip</b> Type <code>C-c C-v t</code> to generate <code>tests/test_sample.py</code>
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">Run pytest</h3>
<div class="outline-text-3" id="text-orgheadline6">
<div class="org-src-container">

<pre class="src src-org"><span style="color: #ff0087;">   #+BEGIN_SRC sh :results output :exports both</span>
   ls tests | grep py
   py.test -v <span style="color: #ff0087;"># </span><span style="color: #ff0087;">-v means =verbose=</span>
<span style="color: #ff0087;">   #+END_SRC</span>

<span style="color: #ff0087;">   #+RESULTS:</span>
<span style="color: #ff0087;">   #+begin_example</span>
<span style="color: #b2b2b2;">   __pycache__</span>
<span style="color: #b2b2b2;">   test_built-in_constants.py</span>
<span style="color: #b2b2b2;">   test_built-in_constants.pyc</span>
<span style="color: #b2b2b2;">   test_sample.py</span>
<span style="color: #b2b2b2;">   test_sample.py~</span>
<span style="color: #b2b2b2;">   test_sample.pyc</span>
<span style="color: #b2b2b2;">   ============================= test session starts ==============================</span>
<span style="color: #b2b2b2;">   platform linux -- Python 3.4.3, pytest-3.0.2, py-1.4.31, pluggy-0.3.1 -- /usr/local/share/DVCS/lib/Python/venv/bin/python3</span>
<span style="color: #b2b2b2;">   cachedir: .cache</span>
<span style="color: #b2b2b2;">   rootdir: /usr/local/share/DVCS/org-pub, inifile: </span>
<span style="color: #b2b2b2;">   collecting ... collected 4 items</span>

<span style="color: #b2b2b2;">   tests/test_built-in_constants.py::TestBuiltInConstants::test_false PASSED</span>
<span style="color: #b2b2b2;">   tests/test_built-in_constants.py::TestBuiltInConstants::test_none PASSED</span>
<span style="color: #b2b2b2;">   tests/test_built-in_constants.py::TestBuiltInConstants::test_true PASSED</span>
<span style="color: #b2b2b2;">   tests/test_sample.py::test_answer FAILED</span>

<span style="color: #b2b2b2;">   =================================== FAILURES ===================================</span>
<span style="color: #b2b2b2;">   _________________________________ test_answer __________________________________</span>

<span style="color: #b2b2b2;">       def test_answer():</span>
<span style="color: #b2b2b2;">   &gt;       assert func(3) == 5</span>
<span style="color: #b2b2b2;">   E       assert 4 == 5</span>
<span style="color: #b2b2b2;">   E        +  where 4 = func(3)</span>

<span style="color: #b2b2b2;">   tests/test_sample.py:6: AssertionError</span>
<span style="color: #b2b2b2;">   ====================== 1 failed, 3 passed in 0.10 seconds ======================</span>
<span style="color: #ff0087;">#+end_example</span>
</pre>
</div>
<hr  />
<p>
<code>pytest</code> evaluated all tests in folder <code>test</code>, but what if you want
to test something <i>particular</i>?
</p>
<hr  />

<div class="org-src-container">

<pre class="src src-org"><span style="color: #ff0087;">   #+BEGIN_SRC sh :results output :exports both</span>
   py.test -v tests/test_sample.py
<span style="color: #ff0087;">   #+END_SRC</span>

<span style="color: #ff0087;">   #+RESULTS:</span>
<span style="color: #ff0087;">   #+begin_example</span>
<span style="color: #b2b2b2;">   ============================= test session starts ==============================</span>
<span style="color: #b2b2b2;">   platform linux -- Python 3.4.3, pytest-3.0.2, py-1.4.31, pluggy-0.3.1 -- /usr/local/share/DVCS/lib/Python/venv/bin/python3</span>
<span style="color: #b2b2b2;">   cachedir: .cache</span>
<span style="color: #b2b2b2;">   rootdir: /usr/local/share/DVCS/org-pub, inifile: </span>
<span style="color: #b2b2b2;">   collecting ... collected 1 items</span>

<span style="color: #b2b2b2;">   tests/test_sample.py::test_answer FAILED</span>

<span style="color: #b2b2b2;">   =================================== FAILURES ===================================</span>
<span style="color: #b2b2b2;">   _________________________________ test_answer __________________________________</span>

<span style="color: #b2b2b2;">       def test_answer():</span>
<span style="color: #b2b2b2;">   &gt;       assert func(3) == 5</span>
<span style="color: #b2b2b2;">   E       assert 4 == 5</span>
<span style="color: #b2b2b2;">   E        +  where 4 = func(3)</span>

<span style="color: #b2b2b2;">   tests/test_sample.py:6: AssertionError</span>
<span style="color: #b2b2b2;">   =========================== 1 failed in 0.05 seconds ===========================</span>
<span style="color: #ff0087;">#+end_example</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">Conclusion</h3>
<div class="outline-text-3" id="text-orgheadline7">
<blockquote>
<p>
<b>Features</b>
</p>
<ul class="org-ul">
<li>Detailed info on failing assert statements (no need to remember self.assert* names);</li>
<li>Auto-discovery of test modules and functions;</li>
<li>Modular fixtures for managing small or parametrized long-lived test resources;</li>
<li>Can run unittest (including trial) and nose test suites out of the box;</li>
<li>Python2.6+, Python3.3+, PyPy-2.3, Jython-2.5 (untested);</li>
<li>Rich plugin architecture, with over 150+ external plugins and thriving community;</li>
</ul>
</blockquote>
</div>
</div>
</div>
